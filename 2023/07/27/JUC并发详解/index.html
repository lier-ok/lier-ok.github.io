

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/cute_icon.png">
  <link rel="icon" href="/img/cute_icon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="lier">
  <meta name="keywords" content="">
  
  <title>JUC并发详解 - Blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.9","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>lier的博客</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/background.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="JUC并发详解">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2023-07-27 10:42" pubdate>
        2023年7月27日 上午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      8.4k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      115
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">JUC并发详解</h1>
            
            <div class="markdown-body">
              <h2 id="JUC并发编程"><a href="#JUC并发编程" class="headerlink" title="JUC并发编程"></a>JUC并发编程</h2><h3 id="1-什么是JUC"><a href="#1-什么是JUC" class="headerlink" title="1: 什么是JUC"></a>1: 什么是JUC</h3><h4 id="1-1-概念"><a href="#1-1-概念" class="headerlink" title="1.1: 概念"></a>1.1: 概念</h4><p> JUC 就是 java.util .concurrent 工具包的简称。这是一个处理线程的工具包，JDK 1.5 开始出现的。</p>
<h3 id="2-线程和进程相关概念"><a href="#2-线程和进程相关概念" class="headerlink" title="2: 线程和进程相关概念"></a>2: 线程和进程相关概念</h3><h4 id="2-1-进程和线程"><a href="#2-1-进程和线程" class="headerlink" title="2.1: 进程和线程"></a>2.1: 进程和线程</h4><p> 进程: 计算机中一个运行起来的程序,是系统进行资源分配和调度的基本单位,是操作系统的结构的基础</p>
<p> 是线程的容器</p>
<p> 线程: 是进程中一个单一的顺序控制流,操作系统能够进行运算调度的最小单位,一个进程可以有一个或多个线程</p>
<h4 id="2-2-线程的状态-生命周期"><a href="#2-2-线程的状态-生命周期" class="headerlink" title="2.2: 线程的状态(生命周期)"></a>2.2: 线程的状态(生命周期)</h4><p> 新建 就绪 运行 阻塞 死亡</p>
<h4 id="2-3-wait与sleep区别"><a href="#2-3-wait与sleep区别" class="headerlink" title="2.3: wait与sleep区别"></a>2.3: wait与sleep区别</h4><p> 相同: 一旦执行就会使线程进入阻塞状态</p>
<p> 不同:</p>
<p> 1: sleep时Thread类中的静态方法,wait是Object中的方法,</p>
<p> 2: sleep不会占用锁,所以可以在任何地方调用,且当前线程有锁时sleep不会释放锁,而wait会占用锁,wait所在当前 线程必须有锁,但是wait不会释放锁</p>
<h4 id="2-4-并发和并行"><a href="#2-4-并发和并行" class="headerlink" title="2.4: 并发和并行"></a>2.4: 并发和并行</h4><p> 串行: 一次只能获取到一个任务,只能处理一个任务,按顺序处理</p>
<p> 并发: 一个CPU核处理多个任务,根据细分时间片交替执行,逻辑上时同时执行</p>
<p> 并行: 多核CPU或多个处理器同时处理多个任务,</p>
<h4 id="2-5-管程"><a href="#2-5-管程" class="headerlink" title="2.5: 管程"></a>2.5: 管程</h4><p> 管程(monitor)是保证了同一时刻只有一个进程在管程内活动,JVM 中同步就是基于进入和退出管程(monitor)对象实现的</p>
<h4 id="2-6-用户线程和守护线程"><a href="#2-6-用户线程和守护线程" class="headerlink" title="2.6: 用户线程和守护线程"></a>2.6: 用户线程和守护线程</h4><p> 用户线程: 平时用到的普通线程,自定义线程</p>
<p> 守护线程: 运行在后台,是一种特殊的线程,比如垃圾回收</p>
<p> 区别: 当主线程结束后,用户线程还在运行,JVM 存活 如果没有用户线程,都是守护线程,JVM 结束</p>
<h3 id="3-Lock接口"><a href="#3-Lock接口" class="headerlink" title="3: Lock接口"></a>3: Lock接口</h3><h4 id="3-1-synchronized"><a href="#3-1-synchronized" class="headerlink" title="3.1: synchronized"></a>3.1: synchronized</h4><h5 id="3-1-1-使用"><a href="#3-1-1-使用" class="headerlink" title="3.1.1: 使用"></a>3.1.1: 使用</h5><p> 同步方法和同步代码块</p>
<p> <strong>synchronized 关键字不能被继承</strong>。如果在父类中的某个方 法使用了 synchronized 关键字，而在子类中覆盖了这个方 法，在子类中的这 个方法默认情况下并不是同步的，而必须显式地在子类的这个方法中加上 synchronized 关键字才可以。 或者在子类方法中调用父类的同步方法</p>
<h5 id="3-1-2-多线程编程步骤-上"><a href="#3-1-2-多线程编程步骤-上" class="headerlink" title="3.1.2: 多线程编程步骤(上)"></a>3.1.2: 多线程编程步骤(<strong>上</strong>)</h5><p> 1: 创建资源类及其属性和操作方法</p>
<p> 2: 创建多线程调用资源类的操作方法</p>
<h5 id="3-1-3-火车售票案列"><a href="#3-1-3-火车售票案列" class="headerlink" title="3.1.3: 火车售票案列"></a>3.1.3: 火车售票案列</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SaleTicket</span> &#123;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Ticket</span> <span class="hljs-variable">ticket</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ticket</span>();<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>           <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;i &lt; <span class="hljs-number">40</span>;i++)&#123;<br>               ticket.sale();<br>           &#125;<br>        &#125;,<span class="hljs-string">&quot;线程1&quot;</span>).start();<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;i &lt; <span class="hljs-number">40</span>;i++)&#123;<br>                ticket.sale();<br>            &#125;<br>        &#125;,<span class="hljs-string">&quot;线程2&quot;</span>).start();<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;i &lt; <span class="hljs-number">40</span>;i++)&#123;<br>                ticket.sale();<br>            &#125;<br>        &#125;,<span class="hljs-string">&quot;线程3&quot;</span>).start();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//创建资源类及其属性和操作方法</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Ticket</span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">ticketNum</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sale</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">if</span>(ticketNum &gt; <span class="hljs-number">0</span>)&#123;<br>            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;售出第&quot;</span> + (<span class="hljs-number">31</span> - ticketNum--) + <span class="hljs-string">&quot;张票,剩余&quot;</span> 									+ ticketNum );<br>        &#125;<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<h5 id="3-1-4-缺陷"><a href="#3-1-4-缺陷" class="headerlink" title="3.1.4: 缺陷"></a>3.1.4: 缺陷</h5><p>如果一个代码块被 synchronized 修饰了，当一个线程获取了对应的锁，并执 行该代码块时，其他线程便只能一直等待，等待获取锁的线程释放锁，而这里 获取锁的线程释放锁只会有两种情况：</p>
<p> 1）获取锁的线程执行完了该代码块，然后线程释放对锁的占有；</p>
<p> 2）线程执行发生异常，此时 JVM 会让线程自动释放锁。</p>
<p>那么<strong>如果这个获取锁的线程由于要等待 IO 或者其他原因（比如调用 sleep 方法）被阻塞了，但是又没有释放锁，其他线程便只能干巴巴地等待，试想一 下，这多么影响程序执行效率。</strong> 因此就需要有一种机制可以不让等待的线程一直无期限地等待下去（比如只等 待一定的时间或者能够响应中断），通过 Lock 就可以办到。</p>
<h4 id="3-2-Lock接口"><a href="#3-2-Lock接口" class="headerlink" title="3.2: Lock接口"></a>3.2: Lock接口</h4><h5 id="3-2-1-lock与synchronized区别"><a href="#3-2-1-lock与synchronized区别" class="headerlink" title="3.2.1: lock与synchronized区别"></a>3.2.1: lock与synchronized区别</h5><p> Lock 不是 Java 语言内置的，synchronized 是 Java 语言的关键字，因此是内 置特性。Lock 是一个类，通过这个类可以实现 同步访问；</p>
<p> lock需要手动上锁和释放锁,而synchronized可以自动上锁和释放锁</p>
<p> lock锁可以让等待锁的线程响应中断, 而synchronized必须等待当前线程执行完</p>
<p> 线程间竞争不激烈时,两者效率差不多,激烈时,lock锁的效率高于synchronized</p>
<h5 id="3-2-2-ReentrantLock"><a href="#3-2-2-ReentrantLock" class="headerlink" title="3.2.2: ReentrantLock"></a>3.2.2: ReentrantLock</h5><p> 可重入锁: 类似排队,进去时上锁,出来时释放锁</p>
<h5 id="3-3-3-案列"><a href="#3-3-3-案列" class="headerlink" title="3.3.3: 案列"></a>3.3.3: 案列</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LSaleTicket</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>       <span class="hljs-type">LTicket</span> <span class="hljs-variable">ticket</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LTicket</span>();<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i++) &#123;<br>                ticket.sale();<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;线程1&quot;</span>).start();<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i++) &#123;<br>                ticket.sale();<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;线程2&quot;</span>).start();<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i++) &#123;<br>                ticket.sale();<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;线程3&quot;</span>).start();<br>    &#125;<br>&#125;<br><br>    <span class="hljs-comment">//创建资源类及其属性和操作方法</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LTicket</span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">ticketNum</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span>;<br><br>    <span class="hljs-comment">//可重入锁</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sale</span><span class="hljs-params">()</span>&#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-keyword">if</span>(ticketNum &gt; <span class="hljs-number">0</span>)&#123;<br>                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;售出第&quot;</span> + (<span class="hljs-number">31</span> - ticketNum--) + <span class="hljs-string">&quot;张票,剩									余&quot;</span> + ticketNum );<br>            &#125;<br>        &#125;<span class="hljs-keyword">finally</span>&#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br>&#125;<br><br><br><br></code></pre></td></tr></table></figure>



<h3 id="4-线程间的通信"><a href="#4-线程间的通信" class="headerlink" title="4: 线程间的通信"></a>4: 线程间的通信</h3><p> <strong>调用start方法并不会立即创建一个线程,而是由操作系统决定的,所以调用start方法不一定创建一个线程</strong></p>
<h4 id="4-1-多线程编程步骤-中"><a href="#4-1-多线程编程步骤-中" class="headerlink" title="4.1: 多线程编程步骤(中)"></a>4.1: 多线程编程步骤(中)</h4><p> 1: 创建资源类及其属性和操作方法</p>
<p> 2: 判断: 判断资源是否满足操作条件, 干活: 操作相应资源, 通知: 通知其他线程进行操作</p>
<p> 3: 创建多线程调用资源类的操作方法</p>
<h4 id="4-2-synchronized-版"><a href="#4-2-synchronized-版" class="headerlink" title="4.2: synchronized 版"></a>4.2: synchronized 版</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Thread1</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">MyTestThread</span> <span class="hljs-variable">myTestThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyTestThread</span>();<br><br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">10</span>;i++)&#123;<br>                myTestThread.incr();<br>            &#125;<br>        &#125;,<span class="hljs-string">&quot;++线程&quot;</span>).start();<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">10</span>;i++)&#123;<br>                myTestThread.decr();<br>            &#125;<br>        &#125;,<span class="hljs-string">&quot;--线程&quot;</span>).start();<br><br><br>    &#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTestThread</span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>    <span class="hljs-comment">//++ 的方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">incr</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//判断</span><br>        <span class="hljs-keyword">if</span>(number != <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-built_in">this</span>.wait();<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//干活</span><br>        number++;<br><br>        System.out.println(Thread.currentThread().getName() +<span class="hljs-string">&quot;: &quot;</span> + number);<br><br>        <span class="hljs-comment">//通知</span><br>        <span class="hljs-built_in">this</span>.notifyAll();<br>    &#125;<br><br>    <span class="hljs-comment">//--的方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decr</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">//判断</span><br>        <span class="hljs-keyword">if</span>(number != <span class="hljs-number">1</span>)&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-built_in">this</span>.wait();<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//干活</span><br>        number--;<br><br>        System.out.println(Thread.currentThread().getName() +<span class="hljs-string">&quot;: &quot;</span> + number);<br><br>        <span class="hljs-comment">//通知</span><br>        <span class="hljs-built_in">this</span>.notifyAll();<br>    &#125;<br>&#125;<br><br><br><br></code></pre></td></tr></table></figure>

<h4 id="4-3-虚假唤醒问题"><a href="#4-3-虚假唤醒问题" class="headerlink" title="4.3: 虚假唤醒问题"></a>4.3: 虚假唤醒问题</h4><p> 描述: 在多线程编程步骤中做判断时,使用if判断,满足条件后,调用wait方法,当前线程1进入阻塞状态,并释放锁,其他线程拿到锁后,成功执行并唤醒其他所有线程(包括当前线程1),此时<strong>由于wait方法在哪里阻塞就在哪里被唤醒的特性,导致if判断失效,从而出现虚假唤醒问题</strong></p>
<p> 解决: <strong>将if判断改为while做判断</strong></p>
<p> 3.3.4: 多线程编程步骤(下)</p>
<p> 1: 创建资源类及其属性和操作方法</p>
<p> 2: 判断: 判断资源是否满足操作条件, 干活: 操作相应资源, 通知: 通知其他线程进行操作</p>
<p> 3: 创建多线程调用资源类的操作方法</p>
<p> 4: 防止虚假唤醒问题</p>
<h4 id="4-4-lock版"><a href="#4-4-lock版" class="headerlink" title="4.4: lock版"></a>4.4: lock版</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LThread</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Share</span> <span class="hljs-variable">share</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Share</span>();<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;i &lt;= <span class="hljs-number">10</span>;i++)&#123;<br>                share.incr();<br>            &#125;<br>        &#125;,<span class="hljs-string">&quot;++线程1&quot;</span>).start();<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;i &lt;= <span class="hljs-number">10</span>;i++)&#123;<br>                share.decr();<br>            &#125;<br>        &#125;,<span class="hljs-string">&quot;--线程1&quot;</span>).start();<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;i &lt;= <span class="hljs-number">10</span>;i++)&#123;<br>                share.incr();<br>            &#125;<br>        &#125;,<span class="hljs-string">&quot;++线程2&quot;</span>).start();<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;i &lt;= <span class="hljs-number">10</span>;i++)&#123;<br>                share.decr();<br>            &#125;<br>        &#125;,<span class="hljs-string">&quot;--线程2&quot;</span>).start();<br><br><br>    &#125;<br><br><br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Share</span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> lock.newCondition();<br><br>    <span class="hljs-comment">//++方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">incr</span><span class="hljs-params">()</span>&#123;<br><br>        lock.lock();<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//判断</span><br>            <span class="hljs-keyword">while</span>(number != <span class="hljs-number">1</span>)&#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    condition.await();<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>            <span class="hljs-comment">//干活</span><br>            number++;<br>            System.out.println(Thread.currentThread().getName() +<span class="hljs-string">&quot;: &quot;</span> + number);<br><br>            <span class="hljs-comment">//唤醒</span><br>            condition.signalAll();<br>        &#125;<span class="hljs-keyword">finally</span>&#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">//--方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decr</span><span class="hljs-params">()</span>&#123;<br>        lock.lock();<br><br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">//判断</span><br>            <span class="hljs-keyword">while</span>(number != <span class="hljs-number">0</span>)&#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    condition.await();<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>            <span class="hljs-comment">//干活</span><br>            number--;<br>            System.out.println(Thread.currentThread().getName() +<span class="hljs-string">&quot;: &quot;</span> + number);<br><br>            <span class="hljs-comment">//唤醒</span><br>            condition.signalAll();<br>        &#125;<span class="hljs-keyword">finally</span>&#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<h3 id="5-线程间定制化化通信"><a href="#5-线程间定制化化通信" class="headerlink" title="5: 线程间定制化化通信"></a>5: 线程间定制化化通信</h3><p> 定义一个标志位,判断标志位来判断时那个线程并进行通信</p>
<h4 id="5-1-案列"><a href="#5-1-案列" class="headerlink" title="5.1: 案列"></a>5.1: 案列</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomizeCommunication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ShareResource</span> <span class="hljs-variable">shareResource</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShareResource</span>();<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">10</span>;i++)&#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    shareResource.print5(i);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;,<span class="hljs-string">&quot;AA&quot;</span>).start();<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">10</span>;i++)&#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    shareResource.print10(i);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;,<span class="hljs-string">&quot;BB&quot;</span>).start();<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">10</span>;i++)&#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    shareResource.print15(i);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;,<span class="hljs-string">&quot;CC&quot;</span>).start();<br>    &#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ShareResource</span>&#123;<br>    <span class="hljs-comment">//标志位</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br><br>    <span class="hljs-comment">//钥匙</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">c1</span> <span class="hljs-operator">=</span> lock.newCondition();<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">c2</span> <span class="hljs-operator">=</span> lock.newCondition();<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">c3</span> <span class="hljs-operator">=</span> lock.newCondition();<br><br>    <span class="hljs-comment">//打印5次,loop表示当前为第几轮</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print5</span><span class="hljs-params">(<span class="hljs-type">int</span> loop)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-keyword">while</span>(flag != <span class="hljs-number">1</span>)&#123;<br>                c1.await();<br>            &#125;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">5</span>;i++)&#123;<br>                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;: &quot;</span> + i + <span class="hljs-string">&quot;,当前轮数: &quot;</span> + loop );<br>            &#125;<br>            <span class="hljs-comment">//修改标志位,通知对应线程</span><br>            flag = <span class="hljs-number">2</span>;<br>            c1.signal();<br>        &#125;<span class="hljs-keyword">finally</span>&#123;<br>           lock.unlock();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">//打印10次,loop表示当前为第几轮</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print10</span><span class="hljs-params">(<span class="hljs-type">int</span> loop)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-keyword">while</span>(flag != <span class="hljs-number">2</span>)&#123;<br>                c2.await();<br>            &#125;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">10</span>;i++)&#123;<br>                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;: &quot;</span> + i + <span class="hljs-string">&quot;,当前轮数: &quot;</span> + loop );<br>            &#125;<br>            <span class="hljs-comment">//修改标志位,通知对应线程</span><br>            flag = <span class="hljs-number">3</span>;<br>            c2.signal();<br>        &#125;<span class="hljs-keyword">finally</span>&#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//打印15次,loop表示当前为第几轮</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print15</span><span class="hljs-params">(<span class="hljs-type">int</span> loop)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-keyword">while</span>(flag != <span class="hljs-number">3</span>)&#123;<br>                c3.await();<br>            &#125;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">15</span>;i++)&#123;<br>                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;: &quot;</span> + i + <span class="hljs-string">&quot;,当前轮数: &quot;</span> + loop );<br>            &#125;<br>            <span class="hljs-comment">//修改标志位,通知对应线程</span><br>            flag = <span class="hljs-number">1</span>;<br>            c3.signal();<br>        &#125;<span class="hljs-keyword">finally</span>&#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<h3 id="6-集合的线程安全"><a href="#6-集合的线程安全" class="headerlink" title="6: 集合的线程安全"></a>6: 集合的线程安全</h3><h4 id="6-1-List集合"><a href="#6-1-List集合" class="headerlink" title="6.1: List集合"></a>6.1: List集合</h4><h5 id="6-1-1相关案列"><a href="#6-1-1相关案列" class="headerlink" title="6.1.1相关案列"></a>6.1.1相关案列</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestArrayList</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;i &lt; <span class="hljs-number">30</span>;i++)&#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>                list.add(UUID.randomUUID().toString());<br><br>                System.out.println(list);<br>            &#125;).start();<br>        &#125;<br>    &#125;<br>&#125;<br><br><br><br></code></pre></td></tr></table></figure>

<p>案列出现java.util.ConcurrentModificationException异常,出现在System.out.println(list)时,因为多个线程操作集合添加数据,由于添加方法时线程不安全的,所以在读取时,可能由线程正在添加,导致出现该异常</p>
<h5 id="6-1-2-解决方案"><a href="#6-1-2-解决方案" class="headerlink" title="6.1.2: 解决方案"></a>6.1.2: 解决方案</h5><h6 id="方案一-使用vector"><a href="#方案一-使用vector" class="headerlink" title="方案一: 使用vector"></a>方案一: 使用vector</h6><p> 因为他是一个线程安全的集合,</p>
<h6 id="方案二-使用Collections工具类"><a href="#方案二-使用Collections工具类" class="headerlink" title="方案二: 使用Collections工具类"></a>方案二: 使用Collections工具类</h6><p> 使用synchronizedList方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestArrayList</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">//        List&lt;String&gt; list = new ArrayList&lt;&gt;();</span><br>		<span class="hljs-comment">//方案一</span><br><span class="hljs-comment">//        List&lt;String&gt; list = new Vector&lt;&gt;();</span><br>        <span class="hljs-comment">//方案二</span><br>        List&lt;String&gt; list = Collections.synchronizedList(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;());<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;i &lt; <span class="hljs-number">30</span>;i++)&#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>                list.add(UUID.randomUUID().toString());<br><br>                System.out.println(list);<br>            &#125;).start();<br>        &#125;<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>



<h6 id="方案三-使用CopyOnWriteArrayList"><a href="#方案三-使用CopyOnWriteArrayList" class="headerlink" title="方案三: 使用CopyOnWriteArrayList"></a>方案三: 使用CopyOnWriteArrayList</h6><p> 该类采用写时复制技术,其写入数据时,会将原数据赋值一份出来进行线程安全的操作(<strong>独立写</strong>),然后再与原来数据合并,没写一次操作一次,<strong>读是并发的</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-type">List</span> <span class="hljs-variable">list</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;i &lt; <span class="hljs-number">30</span>;i++)&#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>                list.add(UUID.randomUUID().toString());<br><br>                System.out.println(list);<br>            &#125;).start();<br>        &#125;<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<h4 id="6-2-Set集合"><a href="#6-2-Set集合" class="headerlink" title="6.2: Set集合"></a>6.2: Set集合</h4><p> 采用CopyOnWriteArraySet</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestArrayList</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        Set&lt;String&gt; set = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArraySet</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;i &lt; <span class="hljs-number">30</span>;i++)&#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>                set.add(UUID.randomUUID().toString());<br><br>                System.out.println(set);<br>            &#125;).start();<br>        &#125;<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>



<h4 id="6-3-Map集合"><a href="#6-3-Map集合" class="headerlink" title="6.3: Map集合"></a>6.3: Map集合</h4><h5 id="方案一-采用collections工具类"><a href="#方案一-采用collections工具类" class="headerlink" title="方案一: 采用collections工具类"></a>方案一: 采用collections工具类</h5><p> 使用synchronizedMap()方法,与List类似</p>
<h5 id="方案二-使用ConcurrentHashMap类"><a href="#方案二-使用ConcurrentHashMap类" class="headerlink" title="方案二: 使用ConcurrentHashMap类"></a>方案二: 使用ConcurrentHashMap类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestArrayList</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        Map&lt;String,String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;i &lt; <span class="hljs-number">30</span>;i++)&#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> String.valueOf(i);<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>                map.put(key,UUID.randomUUID().toString());<br><br>                System.out.println(map);<br>            &#125;).start();<br>        &#125;<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<h3 id="7-多线程锁"><a href="#7-多线程锁" class="headerlink" title="7: 多线程锁"></a>7: 多线程锁</h3><h4 id="7-1-synchronized锁"><a href="#7-1-synchronized锁" class="headerlink" title="7.1: synchronized锁"></a>7.1: synchronized锁</h4><p> synchronized实现同步的基础: java的每个对象都可以充当锁</p>
<p> 同步方法: 锁为当前对象,范围就是当前对象所有synchronized方法,</p>
<p> 同步静态方法: 锁为当前类,范围就是当前类所有实例的synchronized方法</p>
<p> 同步代码块: 锁为synchronized括号中的声明</p>
<h4 id="7-2-公平锁和非公平锁"><a href="#7-2-公平锁和非公平锁" class="headerlink" title="7.2: 公平锁和非公平锁"></a>7.2: 公平锁和非公平锁</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-comment">//空参构造或传入false: 非公平锁</span><br><span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br><span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>(<span class="hljs-literal">false</span>);<br><br><span class="hljs-comment">//传入true: 公平锁</span><br><span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>(<span class="hljs-literal">true</span>);<br><br><br></code></pre></td></tr></table></figure>

<p>区别: 公平锁会使每个线程都能获取任务执行,但不能保证每个线程执行任务数相同,效率低,因为他在执行任务时会获取当前任务是否有线程在执行,有就不执行去排队</p>
<p>非公平锁: 有可能所有的任务都被其中一个线程执行,造成其他线程没有任务执行的情况,出现线程 “饿死” 现象,但是其效率高于公平锁,因为它只要发现当前任务没有执行,就直接执行,相对于公平锁少了获取当前任务是否有线程在执行的问题</p>
<h4 id="7-3-可重入锁"><a href="#7-3-可重入锁" class="headerlink" title="7.3: 可重入锁"></a>7.3: 可重入锁</h4><p> synchronized和lock都是可重入锁,通过以下案列实现,</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-comment">//嵌套</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">synchronized</span>(TestReentrantLock.class)&#123;<br>                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;: &quot;</span> + <span class="hljs-string">&quot;外层&quot;</span>);<br>                <span class="hljs-keyword">synchronized</span>(TestReentrantLock.class)&#123;<br>                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;: &quot;</span> + <span class="hljs-string">&quot;中层&quot;</span>);<br>                    <span class="hljs-keyword">synchronized</span>(TestReentrantLock.class)&#123;<br>                        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;: &quot;</span> + <span class="hljs-string">&quot;内层&quot;</span>);<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;,<span class="hljs-string">&quot;aa&quot;</span>).start();<br>    &#125;<br><span class="hljs-comment">//递归</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestReentrantLock</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestReentrantLock</span>().add();<br>        &#125;,<span class="hljs-string">&quot;aa&quot;</span>).start();<br>    &#125;<br><br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">()</span>&#123;<br>        add();<br>    &#125;<br>&#125;<br><span class="hljs-comment">//lock</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span>&#123;<br>                lock.lock();<br>                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;: 外层&quot;</span>);<br>                <span class="hljs-keyword">try</span>&#123;<br>                    lock.lock();<br>                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;: 中层&quot;</span>);<br>                    <span class="hljs-keyword">try</span>&#123;<br>                        lock.lock();<br>                        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;: 内层&quot;</span>);<br>                    &#125;<span class="hljs-keyword">finally</span>&#123;<br>                        lock.unlock();<br>                    &#125;;<br>                &#125;<span class="hljs-keyword">finally</span>&#123;<br>                    lock.unlock();<br>                &#125;;<br>            &#125;<span class="hljs-keyword">finally</span>&#123;<br>                lock.unlock();<br>            &#125;;<br>        &#125;,<span class="hljs-string">&quot;aa&quot;</span>).start();<br>    &#125;<br><span class="hljs-comment">//将中层的释放锁注释之后,依然可以执行内存代码</span><br><br><br></code></pre></td></tr></table></figure>

<p>特点: synchronized和lock都是可重入锁,当前线程获得最外层锁时,就可以无视内层的所有锁,依然可以内层代码</p>
<h4 id="7-4-死锁"><a href="#7-4-死锁" class="headerlink" title="7.4: 死锁"></a>7.4: 死锁</h4><h5 id="7-4-1-概念"><a href="#7-4-1-概念" class="headerlink" title="7.4.1: 概念"></a>7.4.1: 概念</h5><p> 两个或者两个以上的线程占有对方需要的同步资源,导致线程一致处于等待现象</p>
<h5 id="7-4-2-产生死锁的原因"><a href="#7-4-2-产生死锁的原因" class="headerlink" title="7.4.2: 产生死锁的原因"></a>7.4.2: 产生死锁的原因</h5><p> 1: 系统资源不足</p>
<p> 2: 运行的推进顺序不合适</p>
<p> 3: 资源分配不当</p>
<h5 id="7-4-3-手写死锁"><a href="#7-4-3-手写死锁" class="headerlink" title="7.4.3: 手写死锁"></a>7.4.3: 手写死锁</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeadLock</span> &#123;<br><br>    <span class="hljs-comment">//定义两个对象充当锁</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">Object</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br>    <span class="hljs-keyword">static</span> <span class="hljs-type">Object</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">synchronized</span>(a)&#123;<br>                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot; 线程持有锁a,试图获取锁b&quot;</span>);<br>                <span class="hljs-keyword">try</span> &#123;<br>                    TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                <span class="hljs-keyword">synchronized</span>(b)&#123;<br>                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;获取到锁b&quot;</span>);<br>                &#125;<br>            &#125;<br>        &#125;,<span class="hljs-string">&quot;A&quot;</span>).start();<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">synchronized</span>(b)&#123;<br>                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot; 线程持有锁b,试图获取锁a&quot;</span>);<br>                <span class="hljs-keyword">try</span> &#123;<br>                    TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                <span class="hljs-keyword">synchronized</span>(a)&#123;<br>                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;获取到锁a&quot;</span>);<br>                &#125;<br>            &#125;<br>        &#125;,<span class="hljs-string">&quot;B&quot;</span>).start();<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>



<h5 id="7-4-4-判断是否为死锁"><a href="#7-4-4-判断是否为死锁" class="headerlink" title="7.4.4: 判断是否为死锁"></a>7.4.4: 判断是否为死锁</h5><p> 1: jps -l : 在idea控制台输入命令,找到当前类对应编号</p>
<p> 2: jstack 编号 : 看是否出现死锁,jstack为jvm堆栈追踪工具</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/lier-ok/typora_pic@main/img/202209301111256.png"><img src="https://cdn.jsdelivr.net/gh/lier-ok/typora_pic@main/img/202209301111256.png" srcset="/img/loading.gif" lazyload alt="img"></a></p>
<h3 id="8-Callable接口"><a href="#8-Callable接口" class="headerlink" title="8: Callable接口"></a>8: Callable接口</h3><h4 id="8-1-callable"><a href="#8-1-callable" class="headerlink" title="8.1: callable"></a>8.1: callable</h4><h5 id="8-1-1-概述"><a href="#8-1-1-概述" class="headerlink" title="8.1.1: 概述"></a>8.1.1: 概述</h5><p> 实现多线程的第三种方案</p>
<h5 id="8-2-2-与Runnable区别"><a href="#8-2-2-与Runnable区别" class="headerlink" title="8.2.2: 与Runnable区别"></a>8.2.2: 与Runnable区别</h5><p> 1: 由于Runnable实现多线程在run方法执行结束后,无法使线程返回结果,所以引入Callable接口,call方法相对run方法可以 返回结果</p>
<p> 2: call()方法可以抛出异常,而run方法不行</p>
<h4 id="8-2-FutureTask-未来任务"><a href="#8-2-FutureTask-未来任务" class="headerlink" title="8.2: FutureTask(未来任务)"></a>8.2: FutureTask(未来任务)</h4><h5 id="8-2-1概念"><a href="#8-2-1概念" class="headerlink" title="8.2.1概念:"></a>8.2.1概念:</h5><p> 不影响主线程的情况下,单开一个线程去执行较为复杂的任务,最终进行汇总,且只汇总一次</p>
<h5 id="8-2-2原理"><a href="#8-2-2原理" class="headerlink" title="8.2.2原理:"></a>8.2.2原理:</h5><p> FutureTask实现了Runnable和Future接口,Future对象用于保存放回结果</p>
<p> <strong>在主线程中需要执行比较耗时的操作时，但又不想阻塞主线程时，可以把这些作业交给 Future 对象在后台完成</strong></p>
<p> <strong>当主线程将来需要时，就可以通过 Future 对象获得后台作业的计算结果或者执 行状态</strong></p>
<p> 一般 FutureTask 多用于耗时的计算，主线程可以在完成自己的任务后，再去获取结果, 仅在计算完成时才能检索结果；<strong>如 果计算尚未完成，则阻塞 get 方法 • 一旦计算完成，就不能再重新开始或取消计算</strong> • get 方法获取结果只有在计算完成时获 取，否则会一直阻塞直到任务转入完 成状态，然后会返回结果或者抛出异常 ,<strong>get 只计算一次,因此 get 方法放到最后</strong></p>
<p> 接口中三个重要方法:</p>
<p> public boolean cancel（boolean mayInterrupt）：用于停止任务。</p>
<p> public Object get（）抛出 InterruptedException，ExecutionException： 用于获取任务的结果。</p>
<p> public boolean isDone（）：如果任务完成，则返回 true，否则返回 false</p>
<h5 id="8-3-3-实现"><a href="#8-3-3-实现" class="headerlink" title="8.3.3: 实现"></a>8.3.3: 实现</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CallableDemo</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException &#123;<br>        <span class="hljs-type">FutureTask</span> <span class="hljs-variable">futureTask</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>(() -&gt; &#123;<br>            System.out.println(Thread.currentThread().getName());<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1024</span>;<br>        &#125;);<br><br><br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(futureTask,<span class="hljs-string">&quot;AA&quot;</span>).start();<br><br>        <span class="hljs-comment">//判断是否执行完成,未完成阻塞等待</span><br>        <span class="hljs-keyword">while</span>(!futureTask.isDone())&#123;<br>            System.out.println(<span class="hljs-string">&quot;wait...&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">//获取计算结果</span><br>        System.out.println(futureTask.get());<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<h3 id="9-JUC辅助类"><a href="#9-JUC辅助类" class="headerlink" title="9: JUC辅助类"></a>9: JUC辅助类</h3><h4 id="9-1-CountDownLatch减少计数"><a href="#9-1-CountDownLatch减少计数" class="headerlink" title="9.1: CountDownLatch减少计数"></a>9.1: CountDownLatch减少计数</h4><h5 id="9-1-1-解决的问题"><a href="#9-1-1-解决的问题" class="headerlink" title="9.1.1: 解决的问题"></a>9.1.1: 解决的问题</h5><p> 当需要当前的多个线程执行完之后,在执行主线程的代码时,采用CountDownLatch</p>
<h5 id="9-2-2-问题复现"><a href="#9-2-2-问题复现" class="headerlink" title="9.2.2: 问题复现"></a>9.2.2: 问题复现</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CountDownLatchDemo</span> &#123;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">6</span>;i++)&#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;同学离开&quot;</span>);<br>            &#125;,String.valueOf(i)).start();<br>        &#125;<br><br>        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;班长锁门&quot;</span>);<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<p> 发现主线程不会等所有线程执行完(所有同学离开)后,在执行</p>
<h5 id="9-2-3-解决"><a href="#9-2-3-解决" class="headerlink" title="9.2.3: 解决"></a>9.2.3: 解决</h5><p> 使用CountDownLatch解决</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CountDownLatchDemo</span> &#123;<br><br>	<span class="hljs-comment">//指定初始值</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">6</span>);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">6</span>;i++)&#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;同学离开&quot;</span>);<br><br>                <span class="hljs-comment">//每个线程执行后,计数-1</span><br>                countDownLatch.countDown();<br>            &#125;,String.valueOf(i)).start();<br>        &#125;<br><br>        <span class="hljs-comment">//等待结果减为0,即以上线程执行完成</span><br>        countDownLatch.await();<br>        System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;班长锁门&quot;</span>);<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<h4 id="9-2-CyclicBarier循环栅栏"><a href="#9-2-CyclicBarier循环栅栏" class="headerlink" title="9.2: CyclicBarier循环栅栏"></a>9.2: CyclicBarier循环栅栏</h4><h5 id="9-2-1-概念"><a href="#9-2-1-概念" class="headerlink" title="9.2.1: 概念"></a>9.2.1: 概念</h5><p> 阻塞指定的线程数,直到阻塞线程都执行完之后,去执行指定的代码</p>
<p> 9.2.2: 案列</p>
<p> 收集其7颗龙珠后,执行召唤神龙的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CyclicBarrierDemo</span> &#123;<br><br>    <span class="hljs-comment">//指定阻塞的线程, 此处为收集七龙珠的所有线程</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">NUM</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//创建循环栅栏对象</span><br>        <span class="hljs-type">CyclicBarrier</span> <span class="hljs-variable">cyclicBarrier</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CyclicBarrier</span>(NUM,() -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;召唤神龙&quot;</span>);<br>        &#125;);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">7</span>;i++)&#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;&#123;<br>                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;星龙珠已收集&quot;</span>);<br><br>                <span class="hljs-comment">//所有线程任务执行完成之前阻塞</span><br>                <span class="hljs-keyword">try</span> &#123;<br>                    cyclicBarrier.await();<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125; <span class="hljs-keyword">catch</span> (BrokenBarrierException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;,String.valueOf(i)).start();<br>        &#125;<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<p>结果:</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/lier-ok/typora_pic@main/img/202209301112903.png"><img src="https://cdn.jsdelivr.net/gh/lier-ok/typora_pic@main/img/202209301112903.png" srcset="/img/loading.gif" lazyload alt="img"></a></p>
<h4 id="9-3-Semaphore信号灯"><a href="#9-3-Semaphore信号灯" class="headerlink" title="9.3: Semaphore信号灯"></a>9.3: Semaphore信号灯</h4><h5 id="9-3-1-概念"><a href="#9-3-1-概念" class="headerlink" title="9.3.1: 概念"></a>9.3.1: 概念</h5><p> 可以通过Semaphore设置当前许可多少线程执行,其他线程阻塞等待</p>
<p> 9.3.2: 案列</p>
<p> 实现六辆汽车,争抢三个停车位</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SemaphoreDemo</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">//指定许可执行的线程数,即这里的停车位</span><br>        <span class="hljs-type">Semaphore</span> <span class="hljs-variable">semaphore</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Semaphore</span>(<span class="hljs-number">3</span>);<br><br>        <span class="hljs-comment">//模拟线程争抢许可执行, 即这里的汽车争抢停车位</span><br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">6</span>;i++)&#123;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>                <span class="hljs-comment">//抢占许可</span><br>                <span class="hljs-keyword">try</span> &#123;<br>                    semaphore.acquire();<br>                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;汽车抢占到车位,停车...&quot;</span>);<br>                    TimeUnit.SECONDS.sleep(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>().nextInt(<span class="hljs-number">5</span>));<br>                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;离开车位&quot;</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<span class="hljs-keyword">finally</span>&#123;<br>                    <span class="hljs-comment">//释放许可</span><br>                    semaphore.release();<br>                &#125;<br><br>            &#125;,String.valueOf(i)).start();<br>        &#125;<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<p>结果</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/lier-ok/typora_pic@main/img/202209301112253.png"><img src="https://cdn.jsdelivr.net/gh/lier-ok/typora_pic@main/img/202209301112253.png" srcset="/img/loading.gif" lazyload alt="img"></a></p>
<h3 id="10-ReentrantReadWriteLock读写锁"><a href="#10-ReentrantReadWriteLock读写锁" class="headerlink" title="10: ReentrantReadWriteLock读写锁"></a>10: ReentrantReadWriteLock读写锁</h3><h4 id="10-1相关锁的介绍"><a href="#10-1相关锁的介绍" class="headerlink" title="10.1相关锁的介绍"></a>10.1相关锁的介绍</h4><p> 悲观锁: 每次执行前都会给对应资源上锁,使其它线程阻塞,执行完之后在释放锁,但不支持并发,</p>
<p> 乐观锁: 给相应资源添加版本号,操作时判断版本号是否一致,支持并发,</p>
<p> 行锁: 会给当前修改的行上锁,其他线程操作当前行会阻塞,当多个线程操作多行时,会出现死锁</p>
<p> 表锁: 会给线程操作的表上锁,其他线程阻塞,不会发生死锁</p>
<p> 读锁: 也叫共享锁,允许当个线程获取同一份数据,但多个线程获取多份数据可能会发生死锁</p>
<p> 写锁: 也叫独占锁,排它锁,当前写操作没有完成时,会阻塞其他的读锁和写锁,多个线程操作多条记录也会出现死锁问题</p>
<p>读锁,写锁死锁问题分析</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/lier-ok/typora_pic@main/img/202209301112830.png"><img src="https://cdn.jsdelivr.net/gh/lier-ok/typora_pic@main/img/202209301112830.png" srcset="/img/loading.gif" lazyload alt="img"></a></p>
<h4 id="10-2-ReentrantReadWriteLock-读写锁"><a href="#10-2-ReentrantReadWriteLock-读写锁" class="headerlink" title="10.2 ReentrantReadWriteLock 读写锁"></a>10.2 ReentrantReadWriteLock 读写锁</h4><h5 id="10-2-1-案列分析"><a href="#10-2-1-案列分析" class="headerlink" title="10.2.1: 案列分析"></a>10.2.1: 案列分析</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCache</span>&#123;<br>    <span class="hljs-comment">//模拟数据缓存</span><br>    <span class="hljs-keyword">private</span> Map&lt;String,Object&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>    <span class="hljs-comment">//写操作</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(String key, Object value)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;正在写入数据&quot;</span>);<br>            cache.put(key,value);<br>            <span class="hljs-comment">//模拟写入时间</span><br>            TimeUnit.MILLISECONDS.sleep(<span class="hljs-number">300</span>);<br>            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;写完了&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-comment">//读操作</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">get</span><span class="hljs-params">(String key)</span>&#123;<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;正在读取数据&quot;</span>);<br>            result = cache.get(key);<br>            <span class="hljs-comment">//模拟写入时间</span><br>            TimeUnit.MILLISECONDS.sleep(<span class="hljs-number">300</span>);<br>            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;读完了&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReadWriteLockDemo</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">MyCache</span> <span class="hljs-variable">myCache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCache</span>();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">5</span>;i++)&#123;<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> i+ <span class="hljs-string">&quot;&quot;</span>;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>                myCache.put(num,num);<br>            &#125;,String.valueOf(i)).start();<br>        &#125;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">5</span>;i++)&#123;<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> i+ <span class="hljs-string">&quot;&quot;</span>;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>                myCache.get(num);<br>            &#125;,String.valueOf(i)).start();<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h5 id="10-2-2-出现问题"><a href="#10-2-2-出现问题" class="headerlink" title="10.2.2: 出现问题:"></a>10.2.2: 出现问题:</h5><p> <strong>发现数据还没写完,就开始读该数据,不合理</strong></p>
<h5 id="10-2-3-解决"><a href="#10-2-3-解决" class="headerlink" title="10.2.3: 解决"></a>10.2.3: 解决</h5><p> 使用读写锁ReentrantReadWriteLock</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCache</span>&#123;<br>    <span class="hljs-comment">//模拟数据缓存</span><br>    <span class="hljs-keyword">private</span> Map&lt;String,Object&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><br>    <span class="hljs-comment">//创建读写锁实例</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReadWriteLock</span> <span class="hljs-variable">rwLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantReadWriteLock</span>();<br><br>    <span class="hljs-comment">//写操作</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(String key, Object value)</span> &#123;<br>        <span class="hljs-comment">//写操作----&gt;写锁</span><br>        rwLock.writeLock().lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;正在写入数据&quot;</span>);<br>            cache.put(key,value);<br>            <span class="hljs-comment">//模拟写入时间</span><br>            TimeUnit.MILLISECONDS.sleep(<span class="hljs-number">300</span>);<br>            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;写完了&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<span class="hljs-keyword">finally</span>&#123;<br>            <span class="hljs-comment">//释放写锁</span><br>            rwLock.writeLock().unlock();<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-comment">//读操作</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">get</span><span class="hljs-params">(String key)</span>&#123;<br>        <span class="hljs-comment">//读操作----&gt;读锁</span><br>        rwLock.readLock().lock();<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;正在读取数据&quot;</span>);<br>            result = cache.get(key);<br>            <span class="hljs-comment">//模拟写入时间</span><br>            TimeUnit.MILLISECONDS.sleep(<span class="hljs-number">300</span>);<br>            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;读完了&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<span class="hljs-keyword">finally</span>&#123;<br>            <span class="hljs-comment">//释放读锁</span><br>            rwLock.readLock().unlock();<br>        &#125;<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReadWriteLockDemo</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">MyCache</span> <span class="hljs-variable">myCache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCache</span>();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">5</span>;i++)&#123;<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> i+ <span class="hljs-string">&quot;&quot;</span>;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>                myCache.put(num,num);<br>            &#125;,String.valueOf(i)).start();<br>        &#125;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">5</span>;i++)&#123;<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> i+ <span class="hljs-string">&quot;&quot;</span>;<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>                myCache.get(num);<br>            &#125;,String.valueOf(i)).start();<br>        &#125;<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<h5 id="10-2-4-发现"><a href="#10-2-4-发现" class="headerlink" title="10.2.4: 发现"></a>10.2.4: 发现</h5><p> 写操作是一个一个执行的,读操作是并发进行的,符合描述读写锁的特点</p>
<p> 一个资源可以被多个读线程访问,或者一个写线程访问,但是读写操作不能存在于一个线程中,<strong>读写互斥,读读共享</strong></p>
<p> <strong>读的时候不能写,写的时候可以读(锁的降级)</strong></p>
<h5 id="10-2-5-读写锁演变过程及缺陷"><a href="#10-2-5-读写锁演变过程及缺陷" class="headerlink" title="10.2.5: 读写锁演变过程及缺陷"></a>10.2.5: 读写锁演变过程及缺陷</h5><p> <strong>演变过程</strong></p>
<p> 1: 无锁情况</p>
<p> 多线程间互相争抢资源,导致资源争抢很乱出现很多线程安全的问题</p>
<p> 2: synchronized和lock</p>
<p> 这两个都是独占锁,读读,读写,写写都只能一个线程通过执行,效率出现问题</p>
<p> 3: ReentrantReadWriteLock读写锁</p>
<p> 相对synchronized和lock读读时可以共享的(多线程访问),</p>
<p> 但是由于其读写互斥的特点,可能出现一致读,没有写的情况,造成写线程 “饿死” 现象</p>
<p> <strong>缺陷</strong>:</p>
<p> 因为读写锁是读写互斥的,所以可能出现一致在读,而没有写的问题</p>
<h5 id="10-2-5-锁的降级"><a href="#10-2-5-锁的降级" class="headerlink" title="10.2.5: 锁的降级"></a>10.2.5: 锁的降级</h5><p> <strong>jdk8说明</strong></p>
<p> 获取写锁—-&gt;获取读锁—–&gt;释放写锁——&gt;释放读锁</p>
<p> 这歌过程会使写锁降级为读锁 —–&gt; 写的时候可以读</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReadWriteLock</span> <span class="hljs-variable">rwLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantReadWriteLock</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br><br>        <span class="hljs-comment">//获取写锁</span><br>        rwLock.writeLock().lock();<br>        System.out.println(<span class="hljs-string">&quot;---write&quot;</span>);<br>        <span class="hljs-comment">//获取读锁</span><br>        rwLock.readLock().lock();<br>        System.out.println(<span class="hljs-string">&quot;---read&quot;</span>);<br><br>        <span class="hljs-comment">//释放写锁</span><br>        rwLock.writeLock().unlock();<br>        <span class="hljs-comment">//释放读锁</span><br>        rwLock.readLock().unlock();<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<p> 而读锁不能升级为写锁——-&gt; 读的时候不能写,读–&gt;写互斥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-comment">//由于读写互斥,该程序不能执行System.out.println(&quot;---write&quot;);</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReadWriteLock</span> <span class="hljs-variable">rwLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantReadWriteLock</span>();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br><br>        <span class="hljs-comment">//获取读锁</span><br>        rwLock.readLock().lock();<br>        System.out.println(<span class="hljs-string">&quot;---read&quot;</span>);<br>        <span class="hljs-comment">//获取写锁</span><br>        rwLock.writeLock().lock();<br>        System.out.println(<span class="hljs-string">&quot;---write&quot;</span>);<br>        <br>        <span class="hljs-comment">//释放读锁</span><br>        rwLock.readLock().unlock();<br><br>        <span class="hljs-comment">//释放写锁</span><br>        rwLock.writeLock().unlock();<br>        <br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<h3 id="11-BlockingQueue阻塞队列"><a href="#11-BlockingQueue阻塞队列" class="headerlink" title="11: BlockingQueue阻塞队列"></a>11: BlockingQueue阻塞队列</h3><h4 id="11-1-概念与结构"><a href="#11-1-概念与结构" class="headerlink" title="11.1: 概念与结构"></a>11.1: 概念与结构</h4><h5 id="11-1-1-概念"><a href="#11-1-1-概念" class="headerlink" title="11.1.1: 概念"></a>11.1.1: 概念</h5><p> 队列: 即先进先出,或者先进后出(特殊队列栈)的一种数据结构,</p>
<p> 阻塞: 满足某种条件后时操作线程进入等待状态</p>
<p> 阻塞队列是一个共享队列,允许多个线程进行操作,<strong>当队列中元素满时,阻塞添加元素的所有队列,直到有元素被其他线程取出</strong></p>
<p><strong>当队列中元素空时,阻塞所有取出元素队列,直到有其他线程添加元素</strong>,这就是阻塞队列</p>
<p> <strong>BlockingQueue 很好的解决了多线程中，如何高效安全 “传输”数据的问题。通过这些高效并且线程安全的队列类，为我们快速搭建 高质量的多线程程序带来极大的便利。</strong></p>
<h5 id="11-1-2-架构图"><a href="#11-1-2-架构图" class="headerlink" title="11.1.2: 架构图"></a>11.1.2: 架构图</h5><p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/lier-ok/typora_pic@main/img/202209301112099.png"><img src="https://cdn.jsdelivr.net/gh/lier-ok/typora_pic@main/img/202209301112099.png" srcset="/img/loading.gif" lazyload alt="img"></a></p>
<h4 id="11-2-阻塞队列分类"><a href="#11-2-阻塞队列分类" class="headerlink" title="11.2: 阻塞队列分类"></a>11.2: 阻塞队列分类</h4><p> BlockingQueue是一个接口,有父接口Collection,Itetable等,其子接口就是不同的阻塞队列实例</p>
<p> <strong>1: ArrayBlockingQueue</strong></p>
<p> 底层由定长的数组实现的有界阻塞队列</p>
<p> <strong>2: LinkedBlockingQueue</strong></p>
<p> 底层由链表实现的有界阻塞队列,长度为Integer.MAX_VALUE</p>
<p> 3: DelayQueue</p>
<p> 使用优先级队列实现的延迟无界阻塞队列</p>
<p> 4: PriorityBlockingQueue</p>
<p> 支持优先级排序的无界阻塞队列</p>
<p> 5: SynchronousQueue</p>
<p> 不存储元素的阻塞队列，也即单个元素的队列</p>
<p> 6: LinkedTransferQueue</p>
<p> 由链表组成的无界阻塞队列</p>
<p> 7: LinkedBlockingDeque</p>
<p> 由链表组成的双向阻塞队列</p>
<h4 id="11-3-常用方法"><a href="#11-3-常用方法" class="headerlink" title="11.3: 常用方法"></a>11.3: 常用方法</h4><p> 抛出异常 返回特殊值 阻塞 阻塞超时</p>
<p>添加 add(e)  offer(e)  put(e)  offer(e,时间,时间单位)</p>
<p>移除 remove()  poll()  tack()  poll(时间,时间单位)</p>
<p>检查是否存在 element(e)   peek(e) 没有 没有</p>
<h3 id="12-线程池ThreadPool"><a href="#12-线程池ThreadPool" class="headerlink" title="12: 线程池ThreadPool"></a>12: 线程池ThreadPool</h3><h4 id="12-1-概述和架构"><a href="#12-1-概述和架构" class="headerlink" title="12.1: 概述和架构"></a>12.1: 概述和架构</h4><h5 id="12-1-1-概述"><a href="#12-1-1-概述" class="headerlink" title="12.1.1: 概述"></a>12.1.1: 概述</h5><p> 类似连接池,将线程统一管理,先将线程创建好,放入池子中,省去每次创建和销毁线程的过程,可以降低资源消耗和提 高响应速度,统一管理</p>
<h5 id="12-1-2-架构"><a href="#12-1-2-架构" class="headerlink" title="12.1.2: 架构"></a>12.1.2: 架构</h5><p> Executors为对应工具类</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/lier-ok/typora_pic@main/img/202209301113793.png"><img src="https://cdn.jsdelivr.net/gh/lier-ok/typora_pic@main/img/202209301113793.png" srcset="/img/loading.gif" lazyload alt="img"></a></p>
<h4 id="12-2-线程池的分类和使用"><a href="#12-2-线程池的分类和使用" class="headerlink" title="12.2: 线程池的分类和使用"></a>12.2: 线程池的分类和使用</h4><h5 id="12-2-1-线程池的分类"><a href="#12-2-1-线程池的分类" class="headerlink" title="12.2.1: 线程池的分类"></a>12.2.1: 线程池的分类</h5><p> <strong>1: Executors.newFixedThreadPool(int n) : 一池N线程</strong></p>
<p> 特点:</p>
<p> 指定一个线程池中有多少个线程,线程池中的线程处于一定的量</p>
<p> 可以很好的控制线程的并发量 线程可以重复被使用</p>
<p> 在显示关闭之前，都将一直存在</p>
<p> 超出一定量的线程被提交时候需在队列中等待</p>
<p> 2: <strong>Executors.newSingleThreadExecutor()</strong> : 一池一线程</p>
<p> 特点:</p>
<p> 线程池中最多执行 1 个线程，之后提交的线程活动将会排在队列中以此 执行</p>
<p> 3: <strong>Executors.newCachedThreadPool()</strong> : 一池可扩容线程</p>
<p> 线程池中数量没有固定，可达到最大值（Interger. MAX_VALUE</p>
<p> 线程池中的线程可进行缓存重复利用和回收（回收默认时间为 1 分钟）</p>
<p> 当线程池中，没有可用线程，会重新创建一个线程</p>
<p> <strong>前三个底层都是采用ThreadPoolExecutor类的构造器实现的</strong></p>
<p> 4: newScheduleThreadPool()</p>
<p> 线程池中具有指定数量的线程，即便是空线程也将保留</p>
<p> 可定时或者 延迟执行线程活动</p>
<p> 适用于需要多个后台线程执行周期任务的场景</p>
<p> 5: newWorkStealingPool</p>
<p> jdk1.8 提供的线程池，底层使用的是 ForkJoinPool 实现，创建一个拥有多个 任务队列的线程池，可以减少连接数， 创建当前可用 cpu 核数的线程来并行执 行任务</p>
<h5 id="12-2-2-使用案例"><a href="#12-2-2-使用案例" class="headerlink" title="12.2.2: 使用案例"></a>12.2.2: 使用案例</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPoolDemo1</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><br>        <span class="hljs-comment">//newFixedThreadPool(int n)</span><br><span class="hljs-comment">//        ExecutorService pool1 = Executors.newFixedThreadPool(5);</span><br><br>        <span class="hljs-comment">//newSingleThreadExecutor()</span><br><span class="hljs-comment">//        ExecutorService pool2 = Executors.newSingleThreadExecutor();</span><br><br>        <span class="hljs-comment">//</span><br>        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">pool3</span> <span class="hljs-operator">=</span> Executors.newCachedThreadPool();<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">10</span>;i++)&#123;<br>                pool3.execute(()-&gt;&#123;<br>                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;办理业务&quot;</span>);<br>                &#125;);<br>            &#125;<br>        &#125;<span class="hljs-keyword">finally</span>&#123;<br>            pool3.shutdown();<br>        &#125;<br><br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<h4 id="12-3-线程池的七个参数"><a href="#12-3-线程池的七个参数" class="headerlink" title="12.3: 线程池的七个参数"></a>12.3: 线程池的七个参数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-comment">//int corePoolSize: 常驻线程数量</span><br><span class="hljs-comment">//int maximumPoolSize: 最大线程数量</span><br><span class="hljs-comment">//long keepAliveTime: 存活时间</span><br><span class="hljs-comment">//TimeUnit unit: 存活时间单位</span><br><span class="hljs-comment">//BlockingQueue&lt;Runnable&gt; workQueue: 阻塞队列</span><br><span class="hljs-comment">//ThreadFactory threadFactory: 线程工厂</span><br><span class="hljs-comment">//RejectedExecutionHandler handler: 拒绝策略</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize,</span><br><span class="hljs-params">                              <span class="hljs-type">int</span> maximumPoolSize,</span><br><span class="hljs-params">                              <span class="hljs-type">long</span> keepAliveTime,</span><br><span class="hljs-params">                              TimeUnit unit,</span><br><span class="hljs-params">                              BlockingQueue&lt;Runnable&gt; workQueue,</span><br><span class="hljs-params">                              ThreadFactory threadFactory,</span><br><span class="hljs-params">                              RejectedExecutionHandler handler)</span> &#123;...&#125;<br><br><br></code></pre></td></tr></table></figure>

<h4 id="12-4-线程池运行流程和拒绝策略"><a href="#12-4-线程池运行流程和拒绝策略" class="headerlink" title="12.4: 线程池运行流程和拒绝策略"></a>12.4: 线程池运行流程和拒绝策略</h4><h5 id="12-4-1-运行流程"><a href="#12-4-1-运行流程" class="headerlink" title="12.4.1: 运行流程"></a>12.4.1: 运行流程</h5><p> ①主线程中调用线程池中的execute方法</p>
<p> <strong>注意:</strong> 创建线程池后,其中线程会清零,创建线程池对象时不会创建线程,只有调用execute方法执行传入该方法中Runnable接口 实现类的run方法时才创建线程</p>
<p> ②如果当前线程池中线程数少于常驻线程数(corePoolSize),创建线程处理当前任务</p>
<p> ③如果线程池中线程数大于或等于常驻线程数,那就把当前任务丢入阻塞队列(workQueue)中,进行等待</p>
<p> ④这时如果阻塞队列满了,且当前线程数小于最大线程数,就新建一个线程进行处理该任务</p>
<p> ⑤如果当前线程数已经大于或等于最大线程数(maximumPoolSize),就使用相应的拒绝策略处理</p>
<p> ⑥当一个线程处于空闲状态时间超过设定的存活时间(keepAliveTime),且当前线程池中线程数大于常驻线程数(corePoolSize),就将该线程停掉,最终线程池中线程数会收缩到常驻线程数(corePoolSize)大小</p>
<h4 id="12-5-自定义线程池"><a href="#12-5-自定义线程池" class="headerlink" title="12.5: 自定义线程池"></a>12.5: 自定义线程池</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomizeThreadPool</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">threadPool</span> <span class="hljs-operator">=</span> PoolUtil.getThreadPool();<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;i &lt;= <span class="hljs-number">10</span>;i++)&#123;<br>                threadPool.execute(()-&gt;&#123;<br>                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;办理业务&quot;</span>);<br>                &#125;);<br>            &#125;<br>        &#125;<span class="hljs-keyword">finally</span>&#123;<br>            threadPool.shutdown();<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PoolUtil</span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ThreadPoolExecutor <span class="hljs-title function_">getThreadPool</span><span class="hljs-params">()</span>&#123;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<span class="hljs-number">2</span>,<br>                               <span class="hljs-number">5</span>,<br>                               <span class="hljs-number">10</span>,<br>                               TimeUnit.SECONDS,<br>                               <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>(<span class="hljs-number">3</span>),<br>                               Executors.defaultThreadFactory(),<br>                               <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.AbortPolicy()<br>        );<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<h3 id="13-Fork-Join分支合并框架"><a href="#13-Fork-Join分支合并框架" class="headerlink" title="13: Fork&#x2F;Join分支合并框架"></a>13: Fork&#x2F;Join分支合并框架</h3><h4 id="13-1-思想"><a href="#13-1-思想" class="headerlink" title="13.1: 思想"></a>13.1: 思想</h4><p> Fork&#x2F;Join 它可以将一个大的任务拆分成多个子任务进行并行处理，最后将子任务结果合并成最后的计算结果，并进行输出。</p>
<p> Fork&#x2F;Join 框架要完成两件事情：</p>
<p> Fork：把一个复杂任务进行分拆，大事化小</p>
<p> Join：把分拆任务的结果进行合并</p>
<h4 id="13-2-结构"><a href="#13-2-结构" class="headerlink" title="13.2: 结构"></a>13.2: 结构</h4><p> 1: ForkJoinTask:我们要使用 Fork&#x2F;Join 框架，首先需要创建一个 ForkJoin 任务。 该类提供了在任务中执行 fork 和 join 的机 制。通常情况下我们不需要直接集 成 ForkJoinTask 类，只需要继承它的子类，Fork&#x2F;Join 框架提供了两个子类： RecursiveAction：用于没有返回结果的任务</p>
<p> RecursiveTask:用于有返回结果的任务</p>
<p> 2: ForkJoinPool:ForkJoinTask 需要通过 ForkJoinPool 来执行</p>
<p>3: RecursiveTask: 继承后可以实现递归(自己调自己)调用的任务</p>
<h4 id="13-3-案例"><a href="#13-3-案例" class="headerlink" title="13.3: 案例"></a>13.3: 案例</h4><p> 实现分开计算1+…+100</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ForkJoinDemo</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException &#123;<br>        <span class="hljs-comment">//分支合并池</span><br>        <span class="hljs-type">ForkJoinPool</span> <span class="hljs-variable">forkJoinPool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForkJoinPool</span>();<br><br>        <span class="hljs-type">MyTask</span> <span class="hljs-variable">myTask</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyTask</span>(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>);<br><br>        ForkJoinTask&lt;Integer&gt; forkJoinTask = forkJoinPool.submit(myTask);<br><br>        <span class="hljs-comment">//获取计算结果</span><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">integer</span> <span class="hljs-operator">=</span> forkJoinTask.get();<br><br>        System.out.println(integer);<br><br>        <span class="hljs-comment">//关闭资源</span><br>        forkJoinPool.shutdown();<br>    &#125;<br><br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecursiveTask</span>&lt;Integer&gt; &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">VALUE</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>; <span class="hljs-comment">//规定差值大于时就进行拆分</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> begin;<span class="hljs-comment">//相加起始值</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> end;<span class="hljs-comment">//相加结束值</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> result;<span class="hljs-comment">//封装计算结果</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyTask</span><span class="hljs-params">(<span class="hljs-type">int</span> begin,<span class="hljs-type">int</span> end)</span>&#123;<br>        <span class="hljs-built_in">this</span>.begin = begin;<br>        <span class="hljs-built_in">this</span>.end = end;<br>    &#125;<br><br>    <span class="hljs-comment">//拆分合并的过程</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> Integer <span class="hljs-title function_">compute</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//判断起始值与结束值差值,进行拆分</span><br>        <span class="hljs-keyword">if</span>((end-begin)&lt;=VALUE)&#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> begin;i &lt;= end;i++)&#123;<br>                result += i;<br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-comment">//计算中间值,进行左右递归拆分</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">midValue</span> <span class="hljs-operator">=</span> (begin + end) /<span class="hljs-number">2</span>;<br>            <span class="hljs-comment">//左递归拆分</span><br>            <span class="hljs-type">MyTask</span> <span class="hljs-variable">myTask1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyTask</span>(begin, midValue);<br>            myTask1.fork();<br>            <span class="hljs-comment">//右递归拆分</span><br>            <span class="hljs-type">MyTask</span> <span class="hljs-variable">myTask2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyTask</span>(midValue + <span class="hljs-number">1</span>, end);<br>            myTask2.fork();<br><br>            <span class="hljs-comment">//合并结果</span><br>            result = myTask1.join() + myTask2.join();<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<h3 id="14-CompletableFuture异步回调"><a href="#14-CompletableFuture异步回调" class="headerlink" title="14: CompletableFuture异步回调"></a>14: CompletableFuture异步回调</h3><h4 id="14-1-异步和同步-略"><a href="#14-1-异步和同步-略" class="headerlink" title="14.1: 异步和同步 略"></a>14.1: 异步和同步 略</h4><h4 id="14-2-实现案例"><a href="#14-2-实现案例" class="headerlink" title="14.2: 实现案例"></a>14.2: 实现案例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-comment">//没有返回值的异步回调</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CompletableFutureDemo</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException &#123;<br><br>        System.out.println(<span class="hljs-string">&quot;开始&quot;</span>);<br>        <span class="hljs-type">CompletableFuture</span> <span class="hljs-variable">completableFuture1</span> <span class="hljs-operator">=</span> CompletableFuture.runAsync(() -&gt; &#123;<br>            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot; completableFuture1&quot;</span>);<br>        &#125;);<br><br>        System.out.println(<span class="hljs-string">&quot;结束&quot;</span>);<br><br>        <span class="hljs-comment">//结束异步回调</span><br>        completableFuture1.get();<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<p>结果:</p>
<p><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/lier-ok/typora_pic@main/img/202209301113830.png"><img src="https://cdn.jsdelivr.net/gh/lier-ok/typora_pic@main/img/202209301113830.png" srcset="/img/loading.gif" lazyload alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-comment">//有返回值的异步回调</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CompletableFutureDemo1</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException &#123;<br><br>        System.out.println(<span class="hljs-string">&quot;开始&quot;</span>);<br>        <span class="hljs-type">CompletableFuture</span> <span class="hljs-variable">completableFuture2</span> <span class="hljs-operator">=</span> CompletableFuture.supplyAsync(() -&gt; &#123;<br>            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot; completableFuture1&quot;</span>);<br><span class="hljs-comment">//            int i = 10/0;</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1024</span>;<br>        &#125;);<br><br>        System.out.println(<span class="hljs-string">&quot;结束&quot;</span>);<br><br>        <span class="hljs-comment">//结束异步回调</span><br>        <span class="hljs-comment">//参数t:返回值</span><br>        <span class="hljs-comment">//参数u:出现的异常</span><br>        completableFuture2.whenComplete((t,u) -&gt;&#123;<br>            System.out.println(<span class="hljs-string">&quot;---t=&quot;</span> + t);<br>            System.out.println(<span class="hljs-string">&quot;---u=&quot;</span> + u);<br>        &#125;).get();<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<p>发现:</p>
<p> <strong>异步回调只有当CompletableFuture对象调用get方法时结束,且不影响主线程执行顺序</strong></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/java/">java</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/07/27/Docker/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Docker</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/07/27/MongoDB/">
                        <span class="hidden-mobile">MongoDB</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <i class="iconfont icon-love"></i>lier 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      $('#local-search-input').on('click', function() {
        searchFunc(path, 'local-search-input', 'local-search-result');
      });
      $('#modalSearch').on('shown.bs.modal', function() {
        $('#local-search-input').focus();
      });
    })()
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
